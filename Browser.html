<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudOS | Persistent Browser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; overflow: hidden; height: 100vh; font-family: 'Segoe UI', sans-serif; }
        .browser-container { background: #1e293b; border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); height: calc(100vh - 100px); }
        .screen-img { cursor: crosshair; width: 100%; height: 100%; object-fit: contain; background: #000; }
        .loading-bar { height: 3px; width: 0%; background: #3b82f6; transition: width 0.3s; }
        .sidebar-item { transition: 0.2s; cursor: pointer; }
        .sidebar-item:hover { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
    </style>
</head>
<body class="text-slate-300">

    <nav class="h-14 border-b border-slate-800 flex items-center px-6 justify-between bg-slate-900">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-cloud text-white text-sm"></i>
            </div>
            <h1 class="font-bold tracking-tight text-white">CloudOS <span class="text-blue-500 text-xs ml-1">v1.0</span></h1>
        </div>
        
        <div class="flex-1 max-w-2xl mx-10">
            <div class="relative group">
                <i class="fas fa-globe absolute left-4 top-3 text-slate-500"></i>
                <input id="urlInput" type="text" placeholder="Search or enter web address..." 
                    class="w-full bg-slate-800 border border-slate-700 rounded-full py-2 pl-12 pr-4 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all">
            </div>
        </div>

        <div class="flex items-center gap-4">
            <span id="sessionStatus" class="flex items-center gap-2 text-[10px] uppercase font-bold text-emerald-500">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> Persistent Session Active
            </span>
        </div>
    </nav>

    <div class="flex h-full">
        <aside class="w-20 border-r border-slate-800 flex flex-col items-center py-6 gap-8 bg-slate-900">
            <div onclick="doAction('goto')" class="sidebar-item p-3 rounded-xl text-slate-500" title="Go / Refresh">
                <i class="fas fa-redo-alt text-xl"></i>
            </div>
            <div onclick="document.getElementById('typeInput').focus()" class="sidebar-item p-3 rounded-xl text-slate-500" title="Keyboard Mode">
                <i class="fas fa-keyboard text-xl"></i>
            </div>
            <div onclick="window.location.reload()" class="sidebar-item p-3 rounded-xl text-slate-500" title="Hard Reset">
                <i class="fas fa-power-off text-xl text-red-500"></i>
            </div>
        </aside>

        <main class="flex-1 p-6 overflow-hidden">
            <div class="browser-container flex flex-col">
                <div class="h-10 bg-slate-800/50 flex items-center px-4 rounded-t-xl border-b border-slate-700">
                    <div class="bg-slate-700 px-4 py-1 rounded-t-lg text-[11px] flex items-center gap-2 border-b-2 border-blue-500">
                        <i class="fab fa-chrome text-blue-400"></i> Cloud Instance
                    </div>
                </div>

                <div class="flex-1 relative group overflow-hidden bg-black">
                    <div id="loadingBar" class="loading-bar absolute top-0 z-50"></div>
                    
                    <img id="browserScreen" src="https://via.placeholder.com/1280x720/0f172a/3b82f6?text=Starting+Secure+Session..." 
                        onclick="handleScreenClick(event)" class="screen-img" alt="Browser Stream">

                    <div id="loader" class="absolute inset-0 bg-slate-900/40 backdrop-blur-[2px] flex items-center justify-center hidden">
                        <div class="bg-slate-800 p-4 rounded-2xl shadow-2xl border border-slate-700 flex items-center gap-3">
                            <i class="fas fa-circle-notch fa-spin text-blue-500"></i>
                            <span class="text-xs font-bold">Syncing Action...</span>
                        </div>
                    </div>
                </div>

                <div class="h-12 bg-slate-900 border-t border-slate-800 flex items-center px-4 gap-4">
                    <i class="fas fa-i-cursor text-slate-500 text-sm"></i>
                    <input id="typeInput" type="text" placeholder="Tap here to type in browser..." 
                        onkeyup="if(event.key==='Enter') doAction('type')"
                        class="flex-1 bg-transparent border-none outline-none text-sm text-blue-400 font-mono">
                    <div class="text-[10px] text-slate-600 font-mono">1280 x 720 Persistent Engine</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = "https://leonardo47s-youtube.hf.space";
        const browserImg = document.getElementById('browserScreen');
        const loader = document.getElementById('loader');
        const loadingBar = document.getElementById('loadingBar');
        const urlInput = document.getElementById('urlInput');
        const typeInput = document.getElementById('typeInput');

        async function doAction(type, extraData = {}) {
            // UI Feedback
            loader.classList.remove('hidden');
            loadingBar.style.width = "40%";
            
            let payload = { action: type, ...extraData };
            
            if(type === 'goto') payload.value = urlInput.value || "https://google.com";
            if(type === 'type') {
                payload.value = typeInput.value;
                typeInput.value = ""; // Clear input
            }

            try {
                const response = await fetch(`${API_BASE}/api/browser/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                if(data.screenshot) {
                    browserImg.src = "data:image/png;base64," + data.screenshot;
                    loadingBar.style.width = "100%";
                    setTimeout(() => loadingBar.style.width = "0%", 500);
                }
            } catch (err) {
                console.error("Sync Error:", err);
                alert("Connection Lost with Hugging Face Space!");
            } finally {
                loader.classList.add('hidden');
            }
        }

        function handleScreenClick(e) {
            // Coordinate Calculation
            const rect = browserImg.getBoundingClientRect();
            const scaleX = 1280 / rect.width;
            const scaleY = 720 / rect.height;
            
            const x = Math.round((e.clientX - rect.left) * scaleX);
            const y = Math.round((e.clientY - rect.top) * scaleY);
            
            doAction('click', { x, y });
        }

        // Auto-refresh screen every 10 seconds for idle sessions
        setInterval(async () => {
            const res = await fetch(`${API_BASE}/api/browser/screenshot`);
            const data = await res.json();
            if(data.screenshot) browserImg.src = "data:image/png;base64," + data.screenshot;
        }, 10000);

    </script>
</body>
</html>

